<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Restaurante — Costeo y Cotización</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Espolon Enchilao</a>
    <div class="d-flex">
      <button id="btnExport" class="btn btn-outline-light me-2"><i class="bi bi-download"></i> Exportar</button>
      <button id="btnImport" class="btn btn-outline-light me-2"><i class="bi bi-upload"></i> Importar</button>
      <button id="btnClear" class="btn btn-outline-light"><i class="bi bi-trash"></i> Reset</button>
    </div>
  </div>
</nav>

<main class="container my-4">
  <div class="row g-4">
    <div class="col-lg-5">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Ingredientes <small class="text-muted">Gestiona inventario</small></h5>

          <form id="formIngrediente" class="row g-2 align-items-end">
            <div class="col-12">
              <label class="form-label">Nombre</label>
              <input id="ingNombre" class="form-control" placeholder="Ej. Tomate" required>
            </div>
            <div class="col-6">
              <label class="form-label">Cantidad total (g, ml o piezas)</label>
              <input id="ingCantidad" type="number" min="0" step="0.01" class="form-control" placeholder="1000" required>
            </div>
            <div class="col-6">
              <label class="form-label">Precio total ($)</label>
              <input id="ingPrecio" type="number" min="0" step="0.01" class="form-control" placeholder="30" required>
            </div>
            <div class="col-6">
              <label class="form-label">Tipo</label>
              <select id="ingTipo" class="form-select">
                <option value="peso">Peso (g/ml)</option>
                <option value="unidad">Unidad (pieza)</option>
              </select>
            </div>
            <div class="col-6 text-end">
              <button class="btn btn-success" type="submit"><i class="bi bi-plus-circle"></i> Agregar</button>
            </div>
          </form>

          <hr>

          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Lista de ingredientes</h6>
            <small id="countIngredientes" class="text-muted"></small>
          </div>

          <div class="table-responsive" style="max-height:340px; overflow:auto;">
            <table class="table table-sm table-hover align-middle">
              <thead class="table-light sticky-top">
                <tr><th>#</th><th>Ingrediente</th><th>Cantidad</th><th>Precio</th><th>C.U.</th><th>Tipo</th><th></th></tr>
              </thead>
              <tbody id="tablaIngredientes"></tbody>
            </table>
          </div>

          <div class="mt-3">
            <canvas id="chartIngredientes" height="150"></canvas>
          </div>

        </div>
      </div>
    </div>

    <div class="col-lg-7">

      <!-- Platillos Libres (existing behavior) + calcular platillo por gramos -->
      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <h5 class="card-title">Platillos libres <small class="text-muted">Porcentajes o calcular desde gramaje</small></h5>

          <div class="row g-2">
            <div class="col-md-7">
              <input id="platNombre" class="form-control" placeholder="Nombre del platillo">
            </div>
            <div class="col-md-5 d-grid">
              <button id="btnCrearPlatillo" class="btn btn-primary"><i class="bi bi-plus-lg"></i> Crear platillo</button>
            </div>
          </div>

          <div class="mt-3">
            <h6 class="mb-2">Receta actual (selecciona ingredientes y porcentaje)</h6>
            <div class="d-flex gap-2 mb-2">
              <select id="selIngrediente" class="form-select">
                <option value="">-- Selecciona ingrediente --</option>
              </select>
              <input id="porcentaje" class="form-control" type="number" min="0" max="1" step="0.01" placeholder="Ej. 0.12">
              <button id="btnAddReceta" class="btn btn-outline-secondary">Agregar</button>
            </div>

            <div class="table-responsive" style="max-height:140px; overflow:auto;">
              <table class="table table-sm">
                <thead><tr><th>Ingrediente</th><th>%</th><th></th></tr></thead>
                <tbody id="tablaReceta"></tbody>
              </table>
            </div>

            <div class="mt-2 text-end">
              <button id="btnSaveRecipe" class="btn btn-success"><i class="bi bi-save"></i> Guardar receta</button>
              <button id="btnClearRecipe" class="btn btn-outline-danger">Limpiar receta</button>
            </div>
          </div>

          <hr>

          <h6 class="mb-2">Calcular platillo desde gramaje (convierte a % automaticamente)</h6>
          <div class="d-flex gap-2 mb-2">
            <select id="selIngredCalc" class="form-select">
              <option value="">-- Selecciona ingrediente --</option>
            </select>
            <input id="gramaje" class="form-control" type="number" min="0" step="0.01" placeholder="Gramaje (g o ml)">
            <button id="btnAddGram" class="btn btn-outline-secondary">Agregar</button>
          </div>
          <div class="table-responsive" style="max-height:140px; overflow:auto;">
            <table class="table table-sm">
              <thead><tr><th>Ingrediente</th><th>Gramaje</th><th>% calculado</th><th></th></tr></thead>
              <tbody id="tablaRecetaGrams"></tbody>
            </table>
          </div>
          <div class="mt-2 text-end">
            <button id="btnCalcularPlatLibre" class="btn btn-info">Calcular platillo</button>
            <button id="btnGuardarPlatLibre" class="btn btn-outline-success">Guardar como platillo libre</button>
          </div>

        </div>
      </div>

      <!-- Platillos de Carta -->
      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <h5 class="card-title">Platillos de carta <small class="text-muted">Ingredientes por unidad / piezas</small></h5>

          <div class="row g-2 mb-2">
            <div class="col-md-8">
              <input id="platCartaNombre" class="form-control" placeholder="Nombre del platillo de carta">
            </div>
            <div class="col-md-4 d-grid">
              <button id="btnCrearPlatCarta" class="btn btn-primary">Crear platillo de carta</button>
            </div>
          </div>

          <div class="d-flex gap-2 mb-2">
            <select id="selIngredCarta" class="form-select">
              <option value="">-- Selecciona ingrediente --</option>
            </select>
            <input id="cantidadCarta" class="form-control" type="number" min="0" step="1" placeholder="Cantidad (piezas o g)">
            <button id="btnAddCarta" class="btn btn-outline-secondary">Agregar</button>
          </div>

          <div class="table-responsive" style="max-height:160px; overflow:auto;">
            <table class="table table-sm">
              <thead><tr><th>Ingrediente</th><th>Cantidad</th><th>Tipo</th><th></th></tr></thead>
              <tbody id="tablaCarta"></tbody>
            </table>
          </div>

          <div class="mt-2 d-flex gap-2 align-items-center">
            <label class="mb-0">Margen %:</label>
            <input id="margenCarta" type="number" class="form-control" style="width:120px" value="30">
            <button id="btnCalcularCarta" class="btn btn-warning">Calcular costo y precio</button>
            <button id="btnGuardarPlatCarta" class="btn btn-success">Guardar platillo de carta</button>
          </div>

          <div id="resultadoCarta" class="mt-3"></div>

        </div>
      </div>

      <!-- Platillos guardados -->
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Platillos guardados</h5>
          <div class="table-responsive" style="max-height:220px; overflow:auto;">
            <table class="table table-sm table-hover">
              <thead class="table-light"><tr><th>#</th><th>Platillo</th><th>Tipo</th><th>Ingredientes</th><th></th></tr></thead>
              <tbody id="tablaPlatillos"></tbody>
            </table>
          </div>

          <hr>

          <h6>Cotizar platillo</h6>
          <div class="row g-2 align-items-end">
            <div class="col-md-5">
              <select id="selPlatillos" class="form-select"><option value="">-- Selecciona platillo --</option></select>
            </div>
            <div class="col-md-3">
              <input id="cantidadPreparar" type="number" class="form-control" placeholder="Cantidad total (g/ml) para platillos libres">
            </div>
            <div class="col-md-2">
              <input id="margen" type="number" class="form-control" placeholder="% ganancia" value="30">
            </div>
            <div class="col-md-2 d-grid">
              <button id="btnCotizar" class="btn btn-warning">Cotizar</button>
            </div>
          </div>

          <div class="mt-3">
            <div id="resultadoCotizacion"></div>
            <canvas id="chartCotizacion" height="140"></canvas>
          </div>

        </div>
      </div>

    </div>
  </div>
</main>

<!-- Modals -->
<div class="modal fade" id="modalEditIngred" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="formEditIngred" class="needs-validation" novalidate>
        <div class="modal-header"><h5 class="modal-title">Editar ingrediente</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <input id="editId" type="hidden">
          <div class="mb-3"><label>Nombre</label><input id="editNombre" class="form-control" required></div>
          <div class="mb-3"><label>Cantidad total</label><input id="editCantidad" type="number" class="form-control" required></div>
          <div class="mb-3"><label>Precio total</label><input id="editPrecio" type="number" class="form-control" required></div>
          <div class="mb-3"><label>Tipo</label>
            <select id="editTipo" class="form-select">
              <option value="peso">Peso (g/ml)</option>
              <option value="unidad">Unidad (pieza)</option>
            </select>
          </div>
        </div>
        <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button class="btn btn-primary" type="submit">Guardar</button></div>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="app.js"></script>
</body>
</html>
